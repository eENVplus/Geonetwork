ker.include("ownership/model.js");ker.include("ownership/view.js");var ownership=null;function init(){ownership=new TransferOwnership();ker.loadMan.wait(ownership)}function TransferOwnership(){var a=new XMLLoader(Env.locUrl+"/xml/transfer-ownership.xml");var d=new Model(a);var c=new View(a);Event.observe("source.user","change",ker.wrap(this,e));this.init=g;this.transfer=b;function g(){c.clearGroupList();d.getEditors(ker.wrap(this,f))}function f(j){if(j.length==0){alert(a.getText("noEditors"))}else{for(var h=0;h<j.length;h++){c.addSourceUser(j[h].id,j[h].surname+" "+j[h].name+" ("+j[h].username+")")}}}function b(j){var m=$(j);var i=m.getAttribute("id");var h=$F("source.user");var l=$F(xml.getElementById(m,"target.group"));var k=$F(xml.getElementById(m,"target.user"));if(k==null){alert(a.getText("noUser"))}else{d.transfer(h,i,k,l,ker.wrap(this,function(n){var o={PRIV:xml.evalXPath(n,"privileges"),MD:xml.evalXPath(n,"metadata")};var p=str.substitute(a.getText("result"),o);alert(p);if(i!=l){Element.remove(m)}}))}}function e(i){c.clearGroupList();var h=$F("source.user");if(h!=""){d.getUserGroups(h,ker.wrap(c,c.addGroupRows))}}};