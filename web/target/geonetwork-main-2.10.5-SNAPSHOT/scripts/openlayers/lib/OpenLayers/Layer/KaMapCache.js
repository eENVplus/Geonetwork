OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(c,b,d,a){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||DEFAULT_FORMAT]},getURL:function(a){a=this.adjustBounds(a);var f=this.map.getResolution();var e=Math.round((this.map.getScale()*10000))/10000;var d=Math.round(a.left/f);var c=-Math.round(a.top/f);var i=Math.floor(d/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w;var h=Math.floor(c/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h;var b=this.url;if(b instanceof Array){b=this.selectUrl(paramsString,b)}var g=[b,"/",this.params.map,"/",e,"/",this.params.g.replace(/\s/g,"_"),"/def/t",h,"/l",i,"/t",c,"l",d,".",this.extension];return g.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});