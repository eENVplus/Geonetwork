OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{url:null,size:null,isBaseLayer:true,standardTileSize:256,numberOfTiers:0,tileCountUpToTier:new Array(),tierSizeInTiles:new Array(),tierImageSize:new Array(),initialize:function(d,c,e,b){this.initializeZoomify(e);var a=[];a.push(d,c,e,{},b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a)},initializeZoomify:function(c){var d=c.clone();var a=new OpenLayers.Size(Math.ceil(d.w/this.standardTileSize),Math.ceil(d.h/this.standardTileSize));this.tierSizeInTiles.push(a);this.tierImageSize.push(d);while(d.w>this.standardTileSize||d.h>this.standardTileSize){d=new OpenLayers.Size(Math.floor(d.w/2),Math.floor(d.h/2));a=new OpenLayers.Size(Math.ceil(d.w/this.standardTileSize),Math.ceil(d.h/this.standardTileSize));this.tierSizeInTiles.push(a);this.tierImageSize.push(d)}this.tierSizeInTiles.reverse();this.tierImageSize.reverse();this.numberOfTiers=this.tierSizeInTiles.length;this.tileCountUpToTier[0]=0;for(var b=1;b<this.numberOfTiers;b++){this.tileCountUpToTier.push(this.tierSizeInTiles[b-1].w*this.tierSizeInTiles[b-1].h+this.tileCountUpToTier[b-1])}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);this.tileCountUpToTier.length=0;this.tierSizeInTiles.length=0;this.tierImageSize.length=0},clone:function(a){if(a==null){a=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(d){d=this.adjustBounds(d);var c=this.map.getResolution();var a=Math.round((d.left-this.tileOrigin.lon)/(c*this.tileSize.w));var h=Math.round((this.tileOrigin.lat-d.top)/(c*this.tileSize.h));var g=this.map.getZoom();var f=a+h*this.tierSizeInTiles[g].w+this.tileCountUpToTier[g];var e="TileGroup"+Math.floor((f)/256)+"/"+g+"-"+a+"-"+h+".jpg";var b=this.url;if(b instanceof Array){b=this.selectUrl(e,b)}return b+e},getImageSize:function(){if(arguments.length>0){bounds=this.adjustBounds(arguments[0]);var c=this.map.getResolution();var a=Math.round((bounds.left-this.tileOrigin.lon)/(c*this.tileSize.w));var f=Math.round((this.tileOrigin.lat-bounds.top)/(c*this.tileSize.h));var e=this.map.getZoom();var b=this.standardTileSize;var d=this.standardTileSize;if(a==this.tierSizeInTiles[e].w-1){var b=this.tierImageSize[e].w%this.standardTileSize}if(f==this.tierSizeInTiles[e].h-1){var d=this.tierImageSize[e].h%this.standardTileSize}return(new OpenLayers.Size(b,d))}else{return this.tileSize}},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},calculateGridLayout:function(a,o,e){var k=e*this.tileSize.w;var c=e*this.tileSize.h;var i=a.left-o.left;var l=Math.floor(i/k)-this.buffer;var j=i/k-l;var f=-j*this.tileSize.w;var m=o.left+l*k;var b=o.top-a.top+c;var h=Math.floor(b/c)-this.buffer;var n=h-b/c;var d=n*this.tileSize.h;var g=o.top-c*h;return{tilelon:k,tilelat:c,tileoffsetlon:m,tileoffsetlat:g,tileoffsetx:f,tileoffsety:d}},CLASS_NAME:"OpenLayers.Layer.Zoomify"});