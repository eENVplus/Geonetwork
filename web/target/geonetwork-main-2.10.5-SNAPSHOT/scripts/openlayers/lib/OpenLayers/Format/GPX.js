OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{extractWaypoints:true,extractTracks:true,extractRoutes:true,extractAttributes:true,initialize:function(a){this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(x){if(typeof x=="string"){x=OpenLayers.Format.XML.prototype.read.apply(this,[x])}var c=[];if(this.extractTracks){var t=x.getElementsByTagName("trk");for(var s=0,u=t.length;s<u;s++){var n={};if(this.extractAttributes){n=this.parseAttributes(t[s])}var h=this.getElementsByTagNameNS(t[s],t[s].namespaceURI,"trkseg");for(var r=0,f=h.length;r<f;r++){var m=this.extractSegment(h[r],"trkpt");c.push(new OpenLayers.Feature.Vector(m,n))}}}if(this.extractRoutes){var a=x.getElementsByTagName("rte");for(var q=0,p=a.length;q<p;q++){var n={};if(this.extractAttributes){n=this.parseAttributes(a[q])}var w=this.extractSegment(a[q],"rtept");c.push(new OpenLayers.Feature.Vector(w,n))}}if(this.extractWaypoints){var b=x.getElementsByTagName("wpt");for(var o=0,u=b.length;o<u;o++){var n={};if(this.extractAttributes){n=this.parseAttributes(b[o])}var e=new OpenLayers.Geometry.Point(b[o].getAttribute("lon"),b[o].getAttribute("lat"));c.push(new OpenLayers.Feature.Vector(e,n))}}if(this.internalProjection&&this.externalProjection){for(var v=0,d=c.length;v<d;v++){c[v].geometry.transform(this.externalProjection,this.internalProjection)}}return c},extractSegment:function(e,f){var d=this.getElementsByTagNameNS(e,e.namespaceURI,f);var b=[];for(var c=0,a=d.length;c<a;c++){b.push(new OpenLayers.Geometry.Point(d[c].getAttribute("lon"),d[c].getAttribute("lat")))}return new OpenLayers.Geometry.LineString(b)},parseAttributes:function(b){var a={};var d=b.firstChild;while(d){if(d.nodeType==1){var c=d.firstChild;if(c.nodeType==3||c.nodeType==4){name=(d.prefix)?d.nodeName.split(":")[1]:d.nodeName;if(name!="trkseg"&&name!="rtept"){a[name]=c.nodeValue}}}d=d.nextSibling}return a},CLASS_NAME:"OpenLayers.Format.GPX"});