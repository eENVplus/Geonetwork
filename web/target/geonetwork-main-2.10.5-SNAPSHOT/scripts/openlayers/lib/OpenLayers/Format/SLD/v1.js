OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:false,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a])},read:function(c,a){a=OpenLayers.Util.applyDefaults(a,this.options);var b={namedLayers:a.namedLayersAsArray===true?[]:{}};this.readChildNodes(c,b);return b},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version");this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(d,e){var c={userStyles:[],namedStyles:[]};this.readChildNodes(d,c);for(var b=0,a=c.userStyles.length;b<a;++b){c.userStyles[b].layerName=c.name}if(e.namedLayers instanceof Array){e.namedLayers.push(c)}else{e.namedLayers[c.name]=c}},NamedStyle:function(b,a){a.namedStyles.push(this.getChildName(b.firstChild))},UserStyle:function(c,a){var d={defaultsPerSymbolizer:true,rules:[]};this.featureTypeCounter=-1;this.readChildNodes(c,d);var b;if(this.multipleSymbolizers){delete d.defaultsPerSymbolizer;b=new OpenLayers.Style2(d)}else{b=new OpenLayers.Style(this.defaultSymbolizer,d)}a.userStyles.push(b)},IsDefault:function(b,a){if(this.getChildValue(b)=="1"){a.isDefault=true}},FeatureTypeStyle:function(b,a){++this.featureTypeCounter;var c={rules:this.multipleSymbolizers?a.rules:[]};this.readChildNodes(b,c);if(!this.multipleSymbolizers){a.rules=c.rules}},Rule:function(b,d){var a;if(this.multipleSymbolizers){a={symbolizers:[]}}var c=new OpenLayers.Rule(a);this.readChildNodes(b,c);d.rules.push(c)},ElseFilter:function(a,b){b.elseFilter=true},MinScaleDenominator:function(a,b){b.minScaleDenominator=parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(b,c){var a={};this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;c.symbolizers.push(new OpenLayers.Symbolizer.Text(a))}else{c.symbolizer.Text=OpenLayers.Util.applyDefaults(a,c.symbolizer.Text)}},Label:function(b,a){var d={};this.readChildNodes(b,d);if(d.property){a.label="${"+d.property+"}"}else{var c=this.readOgcExpression(b);if(c){a.label=c}}},Font:function(b,a){this.readChildNodes(b,a)},Halo:function(b,a){var c={};this.readChildNodes(b,c);a.haloRadius=c.haloRadius;a.haloColor=c.fillColor;a.haloOpacity=c.fillOpacity},Radius:function(c,b){var a=this.readOgcExpression(c);if(a!=null){b.haloRadius=a}},RasterSymbolizer:function(b,c){var a={};this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;c.symbolizers.push(new OpenLayers.Symbolizer.Raster(a))}else{c.symbolizer.Raster=OpenLayers.Util.applyDefaults(a,c.symbolizer.Raster)}},Geometry:function(a,b){b.geometry={};this.readChildNodes(a,b.geometry)},ColorMap:function(b,a){a.colorMap=[];this.readChildNodes(b,a.colorMap)},ColorMapEntry:function(b,a){var c=b.getAttribute("quantity");var d=b.getAttribute("opacity");a.push({color:b.getAttribute("color"),quantity:c!==null?parseFloat(c):undefined,label:b.getAttribute("label")||undefined,opacity:d!==null?parseFloat(d):undefined})},LineSymbolizer:function(b,c){var a={};this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;c.symbolizers.push(new OpenLayers.Symbolizer.Line(a))}else{c.symbolizer.Line=OpenLayers.Util.applyDefaults(a,c.symbolizer.Line)}},PolygonSymbolizer:function(b,c){var a={fill:false,stroke:false};if(!this.multipleSymbolizers){a=c.symbolizer.Polygon||a}this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;c.symbolizers.push(new OpenLayers.Symbolizer.Polygon(a))}else{c.symbolizer.Polygon=a}},PointSymbolizer:function(b,c){var a={fill:false,stroke:false,graphic:false};if(!this.multipleSymbolizers){a=c.symbolizer.Point||a}this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;c.symbolizers.push(new OpenLayers.Symbolizer.Point(a))}else{c.symbolizer.Point=a}},Stroke:function(b,a){a.stroke=true;this.readChildNodes(b,a)},Fill:function(b,a){a.fill=true;this.readChildNodes(b,a)},CssParameter:function(c,b){var a=c.getAttribute("name");var e=this.cssMap[a];if(e){var d=this.readOgcExpression(c);if(d){b[e]=d}}},Graphic:function(e,d){d.graphic=true;var h={};this.readChildNodes(e,h);var c=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"];var g,f;for(var b=0,a=c.length;b<a;++b){g=c[b];f=h[g];if(f!=undefined){d[g]=f}}if(h.opacity!=undefined){d.graphicOpacity=h.opacity}if(h.size!=undefined){d.pointRadius=h.size/2}if(h.href!=undefined){d.externalGraphic=h.href}if(h.rotation!=undefined){d.rotation=h.rotation}},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(b,c){var a=this.readOgcExpression(b);if(a){c.opacity=a}},Size:function(b,c){var a=this.readOgcExpression(b);if(a){c.size=a}},Rotation:function(b,c){var a=this.readOgcExpression(b);if(a){c.rotation=a}},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b=null;for(var c in this.cssMap){if(this.cssMap[c]==a){b=c;break}}return b},getGraphicFormat:function(a){var d,c;for(var b in this.graphicFormats){if(this.graphicFormats[b].test(a)){d=b;break}}return d||this.defautlGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(e){var b=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});b.setAttribute("xmlns:ogc",this.namespaces.ogc);b.setAttribute("xmlns:gml",this.namespaces.gml);if(e.name){this.writeNode("Name",e.name,b)}if(e.title){this.writeNode("Title",e.title,b)}if(e.description){this.writeNode("Abstract",e.description,b)}if(e.namedLayers instanceof Array){for(var d=0,a=e.namedLayers.length;d<a;++d){this.writeNode("NamedLayer",e.namedLayers[d],b)}}else{for(var c in e.namedLayers){this.writeNode("NamedLayer",e.namedLayers[c],b)}}return b},Name:function(a){return this.createElementNSPlus("sld:Name",{value:a})},Title:function(a){return this.createElementNSPlus("sld:Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("sld:Abstract",{value:a})},NamedLayer:function(c){var d=this.createElementNSPlus("sld:NamedLayer");this.writeNode("Name",c.name,d);if(c.namedStyles){for(var b=0,a=c.namedStyles.length;b<a;++b){this.writeNode("NamedStyle",c.namedStyles[b],d)}}if(c.userStyles){for(var b=0,a=c.userStyles.length;b<a;++b){this.writeNode("UserStyle",c.userStyles[b],d)}}return d},NamedStyle:function(a){var b=this.createElementNSPlus("sld:NamedStyle");this.writeNode("Name",a,b);return b},UserStyle:function(b){var d=this.createElementNSPlus("sld:UserStyle");if(b.name){this.writeNode("Name",b.name,d)}if(b.title){this.writeNode("Title",b.title,d)}if(b.description){this.writeNode("Abstract",b.description,d)}if(b.isDefault){this.writeNode("IsDefault",b.isDefault,d)}if(this.multipleSymbolizers&&b.rules){var m={0:[]};var c=[0];var l,a,p,k,h;for(var f=0,o=b.rules.length;f<o;++f){l=b.rules[f];if(l.symbolizers){a={};for(var e=0,g=l.symbolizers.length;e<g;++e){p=l.symbolizers[e];k=p.zIndex;if(!(k in a)){h=l.clone();h.symbolizers=[];a[k]=h}a[k].symbolizers.push(p.clone())}for(k in a){if(!(k in m)){c.push(k);m[k]=[]}m[k].push(a[k])}}else{m[0].push(l.clone())}}c.sort();var n;for(var f=0,o=c.length;f<o;++f){n=m[c[f]];if(n.length>0){h=b.clone();h.rules=m[c[f]];this.writeNode("FeatureTypeStyle",h,d)}}}else{this.writeNode("FeatureTypeStyle",b,d)}return d},IsDefault:function(a){return this.createElementNSPlus("sld:IsDefault",{value:(a)?"1":"0"})},FeatureTypeStyle:function(c){var d=this.createElementNSPlus("sld:FeatureTypeStyle");for(var b=0,a=c.rules.length;b<a;++b){this.writeNode("Rule",c.rules[b],d)}return d},Rule:function(h){var g=this.createElementNSPlus("sld:Rule");if(h.name){this.writeNode("Name",h.name,g)}if(h.title){this.writeNode("Title",h.title,g)}if(h.description){this.writeNode("Abstract",h.description,g)}if(h.elseFilter){this.writeNode("ElseFilter",null,g)}else{if(h.filter){this.writeNode("ogc:Filter",h.filter,g)}}if(h.minScaleDenominator!=undefined){this.writeNode("MinScaleDenominator",h.minScaleDenominator,g)}if(h.maxScaleDenominator!=undefined){this.writeNode("MaxScaleDenominator",h.maxScaleDenominator,g)}var f,e;if(this.multipleSymbolizers&&h.symbolizers){var e;for(var c=0,d=h.symbolizers.length;c<d;++c){e=h.symbolizers[c];f=e.CLASS_NAME.split(".").pop();this.writeNode(f+"Symbolizer",e,g)}}else{var b=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var c=0,a=b.length;c<a;++c){f=b[c];e=h.symbolizer[f];if(e){this.writeNode(f+"Symbolizer",e,g)}}}return g},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("sld:MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("sld:LineSymbolizer");this.writeNode("Stroke",a,b);return b},Stroke:function(a){var b=this.createElementNSPlus("sld:Stroke");if(a.strokeColor!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeColor"},b)}if(a.strokeOpacity!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeOpacity"},b)}if(a.strokeWidth!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeWidth"},b)}if(a.strokeDashstyle!=undefined&&a.strokeDashstyle!=="solid"){this.writeNode("CssParameter",{symbolizer:a,key:"strokeDashstyle"},b)}if(a.strokeLinecap!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeLinecap"},b)}return b},CssParameter:function(a){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("sld:TextSymbolizer");if(a.label!=null){this.writeNode("Label",a.label,b)}if(a.fontFamily!=null||a.fontSize!=null||a.fontWeight!=null||a.fontStyle!=null){this.writeNode("Font",a,b)}if(a.haloRadius!=null||a.haloColor!=null||a.haloOpacity!=null){this.writeNode("Halo",a,b)}if(a.fillColor!=null||a.fillOpacity!=null){this.writeNode("Fill",a,b)}return b},Font:function(a){var b=this.createElementNSPlus("sld:Font");if(a.fontFamily){this.writeNode("CssParameter",{symbolizer:a,key:"fontFamily"},b)}if(a.fontSize){this.writeNode("CssParameter",{symbolizer:a,key:"fontSize"},b)}if(a.fontWeight){this.writeNode("CssParameter",{symbolizer:a,key:"fontWeight"},b)}if(a.fontStyle){this.writeNode("CssParameter",{symbolizer:a,key:"fontStyle"},b)}return b},Label:function(b){var f=this.createElementNSPlus("sld:Label");var g=b.split("${");f.appendChild(this.createTextNode(g[0]));var e,d;for(var c=1,a=g.length;c<a;c++){e=g[c];d=e.indexOf("}");if(d>0){this.writeNode("ogc:PropertyName",{property:e.substring(0,d)},f);f.appendChild(this.createTextNode(e.substring(++d)))}else{f.appendChild(this.createTextNode("${"+e))}}return f},Halo:function(a){var b=this.createElementNSPlus("sld:Halo");if(a.haloRadius){this.writeNode("Radius",a.haloRadius,b)}if(a.haloColor||a.haloOpacity){this.writeNode("Fill",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b)}return b},Radius:function(a){return this.createElementNSPlus("sld:Radius",{value:a})},RasterSymbolizer:function(a){var b=this.createElementNSPlus("sld:RasterSymbolizer");if(a.geometry){this.writeNode("Geometry",a.geometry,b)}if(a.opacity){this.writeNode("Opacity",a.opacity,b)}if(a.colorMap){this.writeNode("ColorMap",a.colorMap,b)}return b},Geometry:function(b){var a=this.createElementNSPlus("sld:Geometry");if(b.property){this.writeNode("ogc:PropertyName",b,a)}return a},ColorMap:function(b){var d=this.createElementNSPlus("sld:ColorMap");for(var c=0,a=b.length;c<a;++c){this.writeNode("ColorMapEntry",b[c],d)}return d},ColorMapEntry:function(c){var d=this.createElementNSPlus("sld:ColorMapEntry");var b=c;d.setAttribute("color",b.color);b.opacity!==undefined&&d.setAttribute("opacity",parseFloat(b.opacity));b.quantity!==undefined&&d.setAttribute("quantity",parseFloat(b.quantity));b.label!==undefined&&d.setAttribute("label",b.label);return d},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("sld:PolygonSymbolizer");if(a.fill!==false){this.writeNode("Fill",a,b)}if(a.stroke!==false){this.writeNode("Stroke",a,b)}return b},Fill:function(a){var b=this.createElementNSPlus("sld:Fill");if(a.fillColor){this.writeNode("CssParameter",{symbolizer:a,key:"fillColor"},b)}if(a.fillOpacity!=null){this.writeNode("CssParameter",{symbolizer:a,key:"fillOpacity"},b)}return b},PointSymbolizer:function(a){var b=this.createElementNSPlus("sld:PointSymbolizer");this.writeNode("Graphic",a,b);return b},Graphic:function(a){var b=this.createElementNSPlus("sld:Graphic");if(a.externalGraphic!=undefined){this.writeNode("ExternalGraphic",a,b)}else{this.writeNode("Mark",a,b)}if(a.graphicOpacity!=undefined){this.writeNode("Opacity",a.graphicOpacity,b)}if(a.pointRadius!=undefined){this.writeNode("Size",a.pointRadius*2,b)}if(a.rotation!=undefined){this.writeNode("Rotation",a.rotation,b)}return b},ExternalGraphic:function(a){var b=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",a.externalGraphic,b);var c=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);this.writeNode("Format",c,b);return b},Mark:function(a){var b=this.createElementNSPlus("sld:Mark");if(a.graphicName){this.writeNode("WellKnownName",a.graphicName,b)}if(a.fill!==false){this.writeNode("Fill",a,b)}if(a.stroke!==false){this.writeNode("Stroke",a,b)}return b},WellKnownName:function(a){return this.createElementNSPlus("sld:WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("sld:Opacity",{value:a})},Size:function(a){return this.createElementNSPlus("sld:Size",{value:a})},Rotation:function(a){return this.createElementNSPlus("sld:Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("sld:Format",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});