Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.LogoSelectionPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoScroll:true,autoWidth:true,layout:"border"},store:undefined,view:undefined,serviceUrl:undefined,logoAddUrl:"logo.add",ref:undefined,setRef:function(a){this.ref=a},getUploadForm:function(){this.uploadForm=new Ext.FormPanel({fileUpload:true,region:"south",height:80,split:true,items:{xtype:"fileuploadfield",id:"form-file",allowBlank:false,emptyText:translate("logoSelect"),hideLabel:true,name:"fname"},buttons:[{text:translate("upload"),scope:this,handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:this.logoAddUrl,scope:this,success:function(a,b){this.store.reload()},failure:function(a){Ext.Msg.alert("Error",a.responseText)}})}}}]});return this.uploadForm},initComponent:function(b){Ext.apply(this,b);Ext.applyIf(this,this.defaultConfig);var a=new Ext.XTemplate('<tpl for="."><div class="logo-wrap"><div id="{name}" class="logo">','<img src="'+this.logoUrl+'{name}" title="{name}"/><span>{name}</span></div></div>',"</tpl>");var c=Ext.data.Record.create([{name:"name",mapping:""}]);this.store=new Ext.data.Store({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:this.serviceUrl,disableCaching:false}),reader:new Ext.data.XmlReader({record:"icon",id:"icon"},c),fields:["name"]});this.view=new Ext.DataView({store:this.store,tpl:a,singleSelect:true,selectedClass:"logo-selected",overClass:"logo-over",itemSelector:"div.logo-wrap",autoScroll:true,listeners:{selectionchange:function(e,f){var d=this.view.getSelectedIndexes();if(f){this.fireEvent("logoselected",this,d);this.ownerCt.hide()}},scope:this}});this.items=[new Ext.Panel({bbar:this.tb,region:"center",split:true,border:true,autoScroll:true,items:[this.view]}),this.getUploadForm()];GeoNetwork.editor.LogoSelectionPanel.superclass.initComponent.call(this);this.addEvents("logoselected");this.store.load()}});Ext.reg("gn_editor_logoselectionpanel",GeoNetwork.editor.LogoSelectionPanel);