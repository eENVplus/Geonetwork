var currenttable=null;var targetRow;document.onmousemove=function(d){if(currenttable&&currenttable.dragObject){d=d||window.event;var a=currenttable.mouseCoords(d);var e=a.y-currenttable.mouseOffset.y;if(e!=currenttable.oldY){var b=e>currenttable.oldY;currenttable.oldY=e;currenttable.dragObject.style.backgroundColor="#eee";var c=currenttable.findDropTargetRow(e);if(c&&currenttable.dragObject!=c){targetRow=c}if(c){if(b&&currenttable.dragObject!=c){currenttable.dragObject.parentNode.insertBefore(currenttable.dragObject,c.nextSibling)}else{if(!b&&currenttable.dragObject!=c){currenttable.dragObject.parentNode.insertBefore(currenttable.dragObject,c)}}}}return false}};document.onmouseup=function(b){if(currenttable&&currenttable.dragObject){var a=currenttable.dragObject;a.style.backgroundColor="transparent";currenttable.dragObject=null;currenttable.onDrop(currenttable.table,a);currenttable=null}};function getEventSource(a){if(window.event){a=window.event;return a.srcElement}else{return a.target}}function TableDnD(){this.dragObject=null;this.mouseOffset=null;this.table=null;this.oldY=0;this.init=function(c){this.table=c;var d=c.tBodies[0].rows;for(var b=0;b<d.length;b++){var a=d[b].getAttribute("NoDrag");if(a==null||a=="undefined"){this.makeDraggable(d[b])}}};this.onDrop=function(b,a){alert("hmm")};this.getPosition=function(c){var b=0;var a=0;if(c.offsetHeight==0){c=c.firstChild}while(c.offsetParent){b+=c.offsetLeft;a+=c.offsetTop;c=c.offsetParent}b+=c.offsetLeft;a+=c.offsetTop;return{x:b,y:a}};this.mouseCoords=function(a){if(a.pageX||a.pageY){return{x:a.pageX,y:a.pageY}}return{x:a.clientX+document.body.scrollLeft-document.body.clientLeft,y:a.clientY+document.body.scrollTop-document.body.clientTop}};this.getMouseOffset=function(d,c){c=c||window.event;var b=this.getPosition(d);var a=this.mouseCoords(c);return{x:a.x-b.x,y:a.y-b.y}};this.makeDraggable=function(b){if(!b){return}var a=this;b.onmousedown=function(c){var d=getEventSource(c);if(d.tagName=="INPUT"||d.tagName=="SELECT"){return true}currenttable=a;a.dragObject=this;a.mouseOffset=a.getMouseOffset(this,c);return false};b.style.cursor="move"};this.findDropTargetRow=function(g){var d=this.table.tBodies[0].rows;for(var b=0;b<d.length;b++){var e=d[b];var f=e.getAttribute("NoDrop");if(f==null||f=="undefined"){var a=this.getPosition(e).y;var c=parseInt(e.offsetHeight)/2;if(e.offsetHeight==0){a=this.getPosition(e.firstChild).y;c=parseInt(e.firstChild.offsetHeight)/2}if((g>a-c)&&(g<(a+c))){return e}}}return null}};