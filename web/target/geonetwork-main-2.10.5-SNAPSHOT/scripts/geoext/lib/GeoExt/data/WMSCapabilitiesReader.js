Ext.namespace("GeoExt.data");GeoExt.data.WMSCapabilitiesReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WMSCapabilities()}if(typeof b!=="function"){b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"queryable",type:"boolean"},{name:"opaque",type:"boolean"},{name:"noSubsets",type:"boolean"},{name:"cascaded",type:"int"},{name:"fixedWidth",type:"int"},{name:"fixedHeight",type:"int"},{name:"minScale",type:"float"},{name:"maxScale",type:"float"},{name:"prefix",type:"string"},{name:"formats"},{name:"styles"},{name:"srs"},{name:"dimensions"},{name:"bbox"},{name:"llbbox"},{name:"attribution"},{name:"keywords"},{name:"identifiers"},{name:"authorityURLs"},{name:"metadataURLs"}])}GeoExt.data.WMSCapabilitiesReader.superclass.constructor.call(this,a,b)};Ext.extend(GeoExt.data.WMSCapabilitiesReader,Ext.data.DataReader,{attributionCls:"gx-attribution",read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}return this.readRecords(b)},serviceExceptionFormat:function(a){if(OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_inimage")>-1){return"application/vnd.ogc.se_inimage"}if(OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_xml")>-1){return"application/vnd.ogc.se_xml"}return a[0]},imageFormat:function(b){var a=b.formats;if(b.opaque&&OpenLayers.Util.indexOf(a,"image/jpeg")>-1){return"image/jpeg"}if(OpenLayers.Util.indexOf(a,"image/png")>-1){return"image/png"}if(OpenLayers.Util.indexOf(a,"image/png; mode=24bit")>-1){return"image/png; mode=24bit"}if(OpenLayers.Util.indexOf(a,"image/gif")>-1){return"image/gif"}return a[0]},imageTransparent:function(a){return a.opaque==undefined||!a.opaque},readRecords:function(t){if(typeof t==="string"||t.nodeType){t=this.meta.format.read(t)}var e=t.version;var c=t.capability||{};var f=c.request&&c.request.getmap&&c.request.getmap.href;var h=c.layers;var g=c.exception?c.exception.formats:[];var p=this.serviceExceptionFormat(g);var o=[];if(f&&h){var l=this.recordType.prototype.fields;var s,b,d,a,k;for(var n=0,r=h.length;n<r;n++){s=h[n];if(s.name){b={};for(var m=0,q=l.length;m<q;m++){a=l.items[m];k=s[a.mapping||a.name]||a.defaultValue;k=a.convert(k);b[a.name]=k}d={attribution:s.attribution?this.attributionMarkup(s.attribution):undefined,minScale:s.minScale,maxScale:s.maxScale};if(this.meta.layerOptions){Ext.apply(d,this.meta.layerOptions)}b.layer=new OpenLayers.Layer.WMS(s.title||s.name,f,{layers:s.name,exceptions:p,format:this.imageFormat(s),transparent:this.imageTransparent(s),version:e},d);o.push(new this.recordType(b,b.layer.id))}}}return{totalRecords:o.length,success:true,records:o}},attributionMarkup:function(a){var b=[];if(a.logo){b.push("<img class='"+this.attributionCls+"-image' src='"+a.logo.href+"' />")}if(a.title){b.push("<span class='"+this.attributionCls+"-title'>"+a.title+"</span>")}if(a.href){for(var c=0;c<b.length;c++){b[c]="<a class='"+this.attributionCls+"-link' href="+a.href+">"+b[c]+"</a>"}}return b.join(" ")}});