Ext.namespace("GeoExt.tree");GeoExt.tree.LayerParamNode=Ext.extend(Ext.tree.TreeNode,{layer:null,param:null,item:null,delimiter:null,allItems:null,constructor:function(a){var b=a||{};b.iconCls=b.iconCls||"gx-tree-layerparam-icon";b.text=b.text||b.item;typeof b.layer=="string"?false:b.layer.getVisibility();this.param=b.param;this.item=b.item;this.delimiter=b.delimiter||",";GeoExt.tree.LayerParamNode.superclass.constructor.apply(this,arguments)},render:function(a){var d=this.attributes.layer;if(typeof d=="string"){var b=this.attributes.layerStore||GeoExt.MapPanel.guess().layers;var c=b.findBy(function(e){return e.get("title")==d});d=b.getAt(c).get("layer")}this.layer=d;this.allItems=this.getItems();this.attributes.checked=d.getVisibility();this.addVisibilityEventHandlers();GeoExt.tree.LayerParamNode.superclass.render.apply(this,arguments)},getItems:function(){var a=this.layer.params[this.param];return a instanceof Array?a:(a?a.split(this.delimiter):[])},createParams:function(a){var b={};b[this.param]=this.layer.params[this.param] instanceof Array?a:a.join(this.delimiter);return b},addVisibilityEventHandlers:function(){this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});this.on({checkchange:this.onCheckChange,scope:this})},onLayerVisibilityChanged:function(){if(this.getItems().length===0){this.layer.mergeNewParams(this.createParams(this.allItems))}var a=this.layer.getVisibility();if(a&&this.getItems().indexOf(this.item)!==-1){this.getUI().toggleCheck(true)}if(!a){this.layer.mergeNewParams(this.createParams([]));this.getUI().toggleCheck(false)}},onCheckChange:function(e,d){var c=this.layer;var b=[];var a=this.getItems();if(d===true&&c.getVisibility()===false&&a.length===this.allItems.length){a=[]}Ext.each(this.allItems,function(g){if((g!==this.item&&a.indexOf(g)!==-1)||(d===true&&g===this.item)){b.push(g)}},this);var f=(b.length>0);f&&c.mergeNewParams(this.createParams(b));if(f!==c.getVisibility()){c.setVisibility(f)}(!f)&&c.mergeNewParams(this.createParams([]))},destroy:function(){var a=this.layer;if(a instanceof OpenLayers.Layer){a.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this})}delete this.layer;this.un("checkchange",this.onCheckChange,this);GeoExt.tree.LayerNode.superclass.destroy.apply(this,arguments)}});Ext.tree.TreePanel.nodeTypes.gx_layerparam=GeoExt.tree.LayerParamNode;