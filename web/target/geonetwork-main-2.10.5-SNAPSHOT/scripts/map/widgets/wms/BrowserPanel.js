Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.BrowserPanel=function(a){Ext.apply(this,a);GeoNetwork.wms.BrowserPanel.superclass.constructor.call(this)};GeoNetwork.wms.BrowserPanel.ADDWMS=0;GeoNetwork.wms.BrowserPanel.WMSLIST=1;Ext.extend(GeoNetwork.wms.BrowserPanel,Ext.Panel,{previewPanel:null,treePanel:null,map:null,previewCenterPoint:null,mode:GeoNetwork.wms.BrowserPanel.WMSLIST,wmsStore:null,url:"",initComponent:function(){GeoNetwork.wms.BrowserPanel.superclass.initComponent.call(this);this.layout="border";this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,previewCenterPoint:this.previewCenterPoint});var c;this.treePanel=new Ext.tree.TreePanel({rootVisible:false,autoScroll:true});c=new Ext.tree.TreeNode({text:"",draggable:false,cls:"folder"});this.treePanel.setRootNode(c);var b;if(this.mode==GeoNetwork.wms.BrowserPanel.ADDWMS){this.form=new Ext.form.FormPanel({labelWidth:25});var d=new Ext.form.TextField({fieldLabel:"URL",name:"wmsurl",value:this.url,width:250,autoHeight:true});this.form.add(d);this.form.add(new Ext.Button({id:"parse",text:OpenLayers.i18n("WMSBrowserConnectButton"),scope:this,handler:this.getWMSCaps}));this.form.add(this.treePanel);b=[this.form]}else{b=[this.treePanel]}var a={autoScroll:true,region:"center",items:b,split:true,width:300,minWidth:300,border:false};var e={region:"east",border:false,items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};this.add(a);this.add(e);if(this.mode==GeoNetwork.wms.BrowserPanel.WMSLIST){this.treeGen=new GeoNetwork.tree.WMSListGenerator({click:this.nodeClick,scope:this,node:this.treePanel.getRootNode(),wmsStore:this.wmsStore})}else{if(this.mode==GeoNetwork.wms.BrowserPanel.ADDWMS){new GeoNetwork.tree.WMSListGenerator({click:this.nodeClick,scope:this,node:this.treePanel.getRootNode(),wmsStore:this.wmsStore});this.treeGen=new GeoNetwork.tree.WMSTreeGenerator({click:this.nodeClick,callback:this.showTree,scope:this})}}this.addButton(OpenLayers.i18n("WMSBrowserAddButton"),this.addLayerToMap,this);this.doLayout();if(this.url!=""){this.getWMSCaps()}},showTree:function(c,b){if(!c){Ext.MessageBox.alert(OpenLayers.i18n("errorTitle"),OpenLayers.i18n("WMSBrowserConnectError"));this.body.dom.style.cursor="default"}var d=b.service.accessContraints;if((d)&&(d.toLowerCase()!="none")&&(d!="-")){var e=new GeoNetwork.DisclaimerWindow({disclaimer:d});e.show();e=null}var a=this.treePanel.getRootNode();if(c){this.treePanel.getRootNode().appendChild(c);c.expand(true)}this.treePanel.show();this.body.dom.style.cursor="default"},loadUrl:function(a){this.form.getForm().findField("wmsurl").setValue(a);this.getWMSCaps()},getWMSCaps:function(b){var a=this.form.getForm().findField("wmsurl").getValue();a=a.replace(/^\s+|\s+$/g,"");if(a!=""){this.body.dom.style.cursor="wait";this.treeGen.loadWMS(a)}},nodeClick:function(a){this.previewPanel.showPreview(a.attributes.wmsLayer)},addLayerToMap:function(){if(this.previewPanel.currentLayer){var a=GeoNetwork.OGCUtil.layerExistsInMap(this.previewPanel.currentLayer,this.map);if(!a){this.previewPanel.currentLayer.events.on({loadstart:function(){this.isLoading=true}});this.previewPanel.currentLayer.events.on({loadend:function(){this.isLoading=false}});this.map.addLayers([this.previewPanel.currentLayer])}else{Ext.MessageBox.alert(OpenLayers.i18n("infoTitle"),OpenLayers.i18n("WMSBrowserDuplicateMsg"))}}}});Ext.reg("gn_wmsbrowserpanel",GeoNetwork.wms.BrowserPanel);