Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.PreviewPanel=function(a){Ext.apply(this,a);GeoNetwork.wms.PreviewPanel.superclass.constructor.call(this)};Ext.extend(GeoNetwork.wms.PreviewPanel,Ext.Panel,{title:OpenLayers.i18n("WMSBrowserPreviewTitle"),baseCls:"x-plain",cls:"x-panel-title-variant1",imgCls:"preview-image",width:250,height:250,currentLayer:null,initComponent:function(){GeoNetwork.wms.PreviewPanel.superclass.initComponent.call(this);this.image=new Ext.BoxComponent({autoEl:{tag:"img","class":this.imgCls,src:Ext.BLANK_IMAGE_URL,width:this.width,height:this.height}});this.add(this.image)},hideMask:function(){if(this.mask){this.mask.hide()}},showMask:function(){if(!this.mask){this.mask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("WMSBrowserPreviewWaitMsg")});Ext.EventManager.addListener(this.image.getEl(),"load",this.hideMask,this);Ext.EventManager.addListener(this.image.getEl(),"error",this.hideMask,this)}this.mask.show()},calculateBBOX:function(f){var j;var k=(parseFloat(f.params.VERSION)>=1.3);if(f.llbbox){if(this.map.getProjection()!=="EPSG:4326"){var b=OpenLayers.Bounds.fromArray(f.llbbox);b=b.transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());j=b.toArray(k)}else{var b=OpenLayers.Bounds.fromArray(f.llbbox);j=b.toArray(k)}}else{j=this.map.maxExtent.toArray(k)}var a=OpenLayers.Bounds.fromArray(j).getCenterLonLat();if(f.minScale>0){var c;if(f.maxScale>0){c=(parseFloat(f.maxScale)+parseFloat(f.minScale))/2}else{c=0.9*parseFloat(f.minScale)}var g=OpenLayers.Util.getResolutionFromScale(c,this.map.units);var e=Math.round(g*this.width);var d=Math.round(g*this.height);var i=a.lon;var h=a.lat;if(e!==0&&d!==0){if(k){j=[h-0.5*d,i-0.5*e,h+0.5*d,i+0.5*e]}else{j=[i-0.5*e,h-0.5*d,i+0.5*e,h+0.5*d]}}}return j.join(",")},showPreview:function(b){if(!b){return}this.showMask();var c=b.map;if(c===null){b.map=this.map}var a=b.getFullRequestString({BBOX:this.calculateBBOX(b),WIDTH:this.width,HEIGHT:this.height});if(c===null){b.map=c}this.currentLayer=b;this.image.getEl().dom.src=a},showPreviewLegend:function(a){this.remove(this.image);this.image=null;this.image=new Ext.BoxComponent({autoEl:{tag:"img","class":this.imgCls,src:a}});this.add(this.image);this.doLayout()}});Ext.reg("gn_wmspreview",GeoNetwork.wms.PreviewPanel);