Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.WMSLayerInfo=function(a){Ext.apply(this,a)};GeoNetwork.wms.WMSLayerInfo.prototype={layerParams:{format:"image/png",transparent:"TRUE"},layerOptions:{ratio:1,singleTile:true,isBaseLayer:false},callback:null,scope:null,layer:null,loadWMS:function(j,e){this.layer=e;var k=j.toLowerCase();var h=(k.indexOf("version=")>-1);var g=(k.indexOf("service=wms")>-1);var d=(k.indexOf("request=getcapabilities")>-1);var f=(k.indexOf("language=")>-1);var b={};if(!h){b.version=GeoNetwork.OGCUtil.getProtocolVersion()}if(!g){b.service="WMS"}if(!d){b.request="GetCapabilities"}if(!f){b.language=GeoNetwork.OGCUtil.getLanguage()}var a=OpenLayers.Util.getParameterString(b);var c=(j.indexOf("?")>-1)?"&":"?";j+=c+a;var i=Ext.Ajax.request({url:OpenLayers.Util.removeTail(OpenLayers.ProxyHost),method:"GET",params:{url:j},failure:this.processFailure,success:this.processSuccess,timeout:10000,scope:this})},processSuccess:function(a){if(!this.parser){this.parser=new OpenLayers.Format.WMSCapabilities()}var c=this.parser.read(a.responseXML||a.responseText);var b;if(c.capability){b=this.processLayers(c,c.capability.nestedLayers)}Ext.callback(this.callback,this.scope,[b,this.layer])},processFailure:function(a){Ext.callback(this.callback,this.scope,[null,this.layer])},createWMSLayer:function(b,a){return new OpenLayers.Layer.WMS(b.title,a,OpenLayers.Util.extend({layers:b.name},this.layerParams),OpenLayers.Util.extend({minScale:b.minScale,queryable:b.queryable,maxScale:b.maxScale,description:b.abstrack,metadataURL:b.metadataURL,llbbox:b.llbbox},this.layerOptions))},processLayers:function(g,j){var d=null;for(var f=0,a=j.length;f<a;++f){var b=j[f];try{var c=b.name.split(",");if(c.indexOf(this.layer.params.LAYERS)!=-1){d=this.createWMSLayer(b,g.service.href);break}}catch(h){}if(typeof(b.nestedLayers)!="undefined"){d=this.processLayers(g,b.nestedLayers);if(d!=null){break}}}return d}};