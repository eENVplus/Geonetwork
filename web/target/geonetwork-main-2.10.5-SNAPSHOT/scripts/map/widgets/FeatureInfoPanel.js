Ext.namespace("GeoNetwork");GeoNetwork.FeatureInfoPanel=function(a){Ext.apply(this,a);GeoNetwork.FeatureInfoPanel.superclass.constructor.call(this)};Ext.extend(GeoNetwork.FeatureInfoPanel,Ext.Panel,{features:null,treePanel:null,infoPanel:null,initComponent:function(){GeoNetwork.FeatureInfoPanel.superclass.initComponent.call(this);this.layout="border";this.treePanel=new Ext.tree.TreePanel({rootVisible:true,autoScroll:true});var b=new Ext.tree.TreeNode({text:OpenLayers.i18n("featureInfoTitle"),draggable:false,expanded:true,cls:"folder"});this.treePanel.setRootNode(b);var a={region:"center",items:[this.treePanel],split:true,minWidth:100};this.infoPanel=new Ext.Panel();this.infoPanel.on("render",function(){if(this.features){this.showFeatures(this.features)}},this);var c={region:"east",items:[this.infoPanel],split:true,plain:true,cls:"popup-variant1",width:400,autoScroll:true};this.add(a);this.add(c);this.doLayout()},setMap:function(a){this.map=a},featureToHTML:function(d){var b='<table class="olFeatureInfoTable" cellspacing="1" cellpadding="1"><tbody>';for(var a in d.attributes){if(a){b+='<tr class="olFeatureInfoRow"><td width="50%" class="olFeatureInfoColumn">'+a+'</td><td width="50%" class="olFeatureInfoValue">'+d.attributes[a]+"</td></tr>"}}b+="</tbody></table>";var c=new Ext.XTemplate(b);c.overwrite(this.infoPanel.body,d)},click:function(e){if(e.attributes.features.length===0){var d='<table class="olFeatureInfoTable" cellpadding="1" cellspacing="1"><tbody>';d+='<tr class="olFeatureInfoRow"><td colspan="2" class="olFeatureInfoValue">'+OpenLayers.i18n("FeatureInfoNoInfo")+"</td></tr>";d+="</tbody></table>";Ext.DomHelper.overwrite(this.infoPanel.body,d)}for(var c=0,a=e.attributes.features.length;c<a;c++){var b=e.attributes.features[c];this.featureToHTML(b)}},clearInfoPanel:function(){if(this.infoPanel.body){Ext.DomHelper.overwrite(this.infoPanel.body,"")}},getLayerTitle:function(c){if(c==null){return"&nbsp"}var d=this.map.getLayersByClass("OpenLayers.Layer.WMS");for(var b=0,a=d.length;b<a;b++){if(d[b].params.LAYERS instanceof Array){if(OpenLayers.Util.indexOf(d[b].params.LAYERS,c)!==-1){return d[b].name}}else{if(d[b].params.LAYERS.indexOf(c)!==-1){return d[b].name}}}},showFeatures:function(a){this.clearInfoPanel();var h=this.treePanel.getRootNode();while(h.firstChild){h.removeChild(h.firstChild)}var d,g,e=[];for(d=0,g=a.length;d<g;d++){var k=false;var f="";if(a[d].type){f=a[d].type}else{if(a[d].gml&&a[d].gml.featureType){f=a[d].gml.featureType}}for(var c=0;c<e.length;c++){if(e[c].title===f){e[c].features.push(a[d]);k=true}}if(k===false){e.push({title:this.getLayerTitle(f),features:[a[d]]})}}for(d=0,g=e.length;d<g;d++){var b=new Ext.tree.TreeNode({text:e[d].title,features:e[d].features});b.addListener("click",this.click,this);h.appendChild(b);if(d===0){h.expand();this.click(b);this.treePanel.getSelectionModel().select(b)}}h.expand()}});Ext.reg("gn_featureinfo",GeoNetwork.FeatureInfoPanel);