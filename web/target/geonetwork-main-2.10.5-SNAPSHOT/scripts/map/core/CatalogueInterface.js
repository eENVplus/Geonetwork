Ext.namespace("GeoNetwork","GeoNetwork.CatalogueInterface");GeoNetwork.CatalogueInterface=function(){var f;var a;var e;var d=function(h){f=h};var g=function(h,p,l){var q=null;for(var j=0,n=p.length;j<n;++j){var k=p[j];try{var m=k.name.split(",");if(m.indexOf(l.params.LAYERS)!=-1){q=k;break}}catch(o){}if(typeof(k.nestedLayers)!="undefined"){q=g(h,k.nestedLayers,l);if(q!==null){break}}}return q};var b=function(p){a.hide();var j=new OpenLayers.Format.WMSCapabilities();var o=j.read(p.responseXML||p.responseText);if(o.capability){var n=o.service.accessContraints;if((n)&&(n.toLowerCase()!="none")&&(n!="-")){var k=new GeoNetwork.DisclaimerWindow({disclaimer:n});k.show();k=null}if(f){for(var r=0,t=e.length;r<t;r++){var l=e[r][0];var h=e[r][1];var s=e[r][2];var m=e[r][3];var q=new OpenLayers.Layer.WMS(l,h,{layers:s,format:"image/png",transparent:"TRUE",version:o.version,language:GeoNetwork.OGCUtil.getLanguage()},{queryable:true,singleTile:true,ratio:1,buffer:0,transitionEffect:"resize",metadata_id:m});if(!GeoNetwork.OGCUtil.layerExistsInMap(q,f)){q.events.on({loadstart:function(){this.isLoading=true}});q.events.on({loadend:function(){this.isLoading=false}});var u=g(o,o.capability.layers,q);if(u){q.queryable=u.queryable;q.name=u.title||q.name;q.llbbox=u.llbbox;q.styles=u.styles;q.dimensions=u.dimensions}f.addLayer(q)}}}}};var c=function(h){a.hide();Ext.MessageBox.alert(OpenLayers.i18n("loadLayer.error.title"),OpenLayers.i18n("loadLayer.error.message"))};return{init:function(h){d(h)},addLayers:function(j){if(j.length===0){return}a=new Ext.LoadMask(f.div,{msg:OpenLayers.Lang.translate("loadLayer.loadingMessage")});a.show();var h=j[0][1];e=j;var n=(h.indexOf("version=")>-1);var m={service:"WMS",request:"GetCapabilities",language:GeoNetwork.OGCUtil.getLanguage()};if(!n){m.version=GeoNetwork.OGCUtil.getProtocolVersion()}var l=OpenLayers.Util.getParameterString(m);var k=(h.indexOf("?")>-1)?"&":"?";h+=k+l;var i=Ext.Ajax.request({url:OpenLayers.Util.removeTail(OpenLayers.ProxyHost),method:"GET",params:{url:h},success:b,failure:c,timeout:10000})}}};GeoNetwork.CatalogueInterface=new GeoNetwork.CatalogueInterface();