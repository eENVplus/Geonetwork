Ext.namespace("GeoNetwork");GeoNetwork.miniapp=function(){var m,j;var h;var e=[];var l;var d;var k=function(p){var o=p||{projection:"EPSG:4326",units:"m",maxExtent:new OpenLayers.Bounds(-180,-90,180,90),restrictedExtent:new OpenLayers.Bounds(-180,-90,180,90),controls:[]};if(!o.controls){o.controls=[]}h=new OpenLayers.Map(o)};var c=function(q,p,r,o){h.addLayer(new OpenLayers.Layer.WMS(q,p,r,o))};var g=function(){h.addControl(new GeoNetwork.Control.ZoomWheel());h.addControl(new OpenLayers.Control.LoadingPanel())};var n=function(o){d=$(o)};var i=function(o){m=[];action=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent(),map:h,iconCls:"zoomfull",tooltip:{title:OpenLayers.i18n("zoomToMaxExtentTooltipTitle"),text:OpenLayers.i18n("zoomToMaxExtentTooltipText")}});m.push(action);m.push("-");action=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox(),map:h,toggleGroup:"move",allowDepress:false,iconCls:"zoomin",tooltip:{title:OpenLayers.i18n("zoominTooltipTitle"),text:OpenLayers.i18n("zoominTooltipText")}});m.push(action);action=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({displayClass:"ZoomOut",out:true}),map:h,toggleGroup:"move",allowDepress:false,tooltip:{title:OpenLayers.i18n("zoomoutTooltipTitle"),text:OpenLayers.i18n("zoomoutTooltipText")},iconCls:"zoomout"});m.push(action);action=new GeoExt.Action({control:new OpenLayers.Control.DragPan({isDefault:true}),toggleGroup:"move",allowDepress:false,pressed:true,map:h,iconCls:"pan",tooltip:{title:OpenLayers.i18n("dragTooltipTitle"),text:OpenLayers.i18n("dragTooltipText")}});m.push(action);m.push("-");l=new GeoNetwork.Control.ExtentBox({minxelement:Ext.get(o.westBL),maxxelement:Ext.get(o.eastBL),minyelement:Ext.get(o.southBL),maxyelement:Ext.get(o.northBL)});l.events.register("finishBox",null,function(p){d.selectedIndex=1;if(e){for(var q=0;q<e.length;q++){e[q].synch(d.selectedIndex,l)}}});action=new GeoExt.Action({control:l,toggleGroup:"move",allowDepress:false,map:h,tooltip:{title:OpenLayers.i18n("selectExtentTooltipTitle"),text:OpenLayers.i18n("selectExtentTooltipText")},iconCls:"selextent"});m.push(action)};var b=function b(o){if(l){l.updateMap();if(o){l.zoomTo()}}};var f=function(p,o){i(o);var q=new GeoExt.MapPanel({id:"mini_mappanel_"+p,renderTo:p,height:150,width:210,border:false,map:h,tbar:m})};var a=function a(){if(l){l.clear();l.minxelement.dom.value="";l.minyelement.dom.value="";l.maxxelement.dom.value="";l.maxyelement.dom.value="";h.zoomToMaxExtent()}};return{init:function(t,p,s,o,r){if(!$(t)){return}Ext.QuickTips.init();n(p);k(o);for(var q=0;q<s.length;q++){c(s[q][0],s[q][1],s[q][2],s[q][3])}f(t,r);g();h.zoomToMaxExtent();Ext.EventManager.on(Ext.get(r.westBL),"change",b);Ext.EventManager.on(Ext.get(r.eastBL),"change",b);Ext.EventManager.on(Ext.get(r.southBL),"change",b);Ext.EventManager.on(Ext.get(r.northBL),"change",b)},clearExtentBox:function(){a()},updateExtentBox:function(){b(true)},getMap:function(){return h},synch:function(o,p){$(d).selectedIndex=o;if(p&&l){l.minxelement.set({value:p.minxelement.getValue()});l.minyelement.set({value:p.minyelement.getValue()});l.maxxelement.set({value:p.maxxelement.getValue()});l.maxyelement.set({value:p.maxyelement.getValue()})}b(false)},setSynchMinimap:function(o){e.push(o)},addWmsLayer:function(q,p,r,o){c(q,p,r,o)}}};GeoNetwork.minimapSimpleSearch=new GeoNetwork.miniapp();GeoNetwork.minimapAdvancedSearch=new GeoNetwork.miniapp();GeoNetwork.minimapRemoteSearch=new GeoNetwork.miniapp();