Ext.namespace("GeoNetwork");GeoNetwork.LogoManagerPanel=Ext.extend(Ext.Panel,{store:undefined,view:undefined,uploadForm:undefined,tb:undefined,height:600,autoWidth:true,layout:"column",border:false,initComponent:function(d){this.renderTo=d;var a=new Ext.XTemplate('<tpl for="."><div class="logo-wrap"><div id="{name}" class="logo">','<img src="../../images/harvesting/{name}" title="{name}"/><span>{name}</span></div></div>',"</tpl>");var c=Ext.data.Record.create([{name:"name",mapping:""}]);this.store=new Ext.data.Store({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:"xml.harvesting.info?type=icons",disableCaching:false}),reader:new Ext.data.XmlReader({record:"icon",id:"icon"},c),fields:["name"]});var b=this;this.tb=new Ext.Toolbar({disabled:true,items:[{xtype:"tbtext",text:translate("selectedLogo")},{xtype:"button",text:translate("logoDel"),listeners:{click:function(){this.removeSelectedLogo()},scope:b}},{xtype:"button",text:translate("logoForNode"),listeners:{click:function(){this.setSelectedLogo(0)},scope:b}},{xtype:"button",text:translate("logoForNodeFavicon"),listeners:{click:function(){this.setSelectedLogo(1)},scope:b}}]});this.view=new Ext.DataView({store:this.store,tpl:a,singleSelect:true,selectedClass:"logo-selected",overClass:"logo-over",itemSelector:"div.logo-wrap",autoScroll:true,height:500,listeners:{selectionchange:function(){var e=this.view.getSelectedIndexes();if(e.length>0){this.tb.enable()}else{this.tb.disable()}},scope:b}});this.items=[{columnWidth:0.7,baseCls:"x-plain",items:[new Ext.Panel({title:translate("logoRegistered"),bbar:this.tb,border:false,items:[this.view]})]},{columnWidth:0.3,baseCls:"x-plain",items:[this.getUploadForm()]}];this.store.on("load",function(){this.view.el.dom.style.overflow="auto"},this);this.store.load();GeoNetwork.LogoManagerPanel.superclass.initComponent.call(this)},onDestroy:function(){GeoNetwork.LogoManagerPanel.superclass.onDestroy.apply(this,arguments)},removeSelectedLogo:function(){var c=this;var d=this.view.getSelectedIndexes();var a=this.view.getStore().getAt(d[0]);var b=a.get("name");OpenLayers.Request.GET({url:"logo.delete?fname="+b,success:function(e){c.store.reload()},failure:function(e){Ext.Msg.alert("Error",e.responseText)}})},setSelectedLogo:function(d){var c=this;var e=this.view.getSelectedIndexes();var a=this.view.getStore().getAt(e[0]);var b=a.get("name");OpenLayers.Request.GET({url:"logo.set?fname="+b+"&favicon="+d,success:function(f){},failure:function(f){Ext.Msg.alert("Error",f.responseText)}})},getUploadForm:function(){var a=this;this.uploadForm=new Ext.FormPanel({title:translate("logoAdd"),fileUpload:true,region:"west",minWidth:250,width:250,split:true,items:{xtype:"fileuploadfield",id:"form-file",allowBlank:false,emptyText:translate("logoSelect"),hideLabel:true,name:"fname"},buttons:[{text:translate("upload"),scope:a,handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:"logo.add",scope:this,success:function(b,c){this.store.reload()},failure:function(b){Ext.Msg.alert("Error",b.responseText)}})}}}]});return this.uploadForm}});Ext.reg("gn_logomanagerpanel",GeoNetwork.LogoManagerPanel);