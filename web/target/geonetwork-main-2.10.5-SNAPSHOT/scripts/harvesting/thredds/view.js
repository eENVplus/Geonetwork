thredds.View=function(b){HarvesterView.call(this);var a=new XSLTransformer("harvesting/thredds/client-privil-row.xsl",b);var t=new XSLTransformer("harvesting/thredds/client-result-tip.xsl",b);var p=b;var v=new Validator(p);var w=null;var C=0;var e="";var c="";this.setPrefix("thredds");this.setPrivilTransf(a);this.setResultTransf(t);this.init=z;this.setEmpty=B;this.setData=g;this.getData=s;this.isDataValid=f;this.clearIcons=k;this.addIcon=y;Event.observe("thredds.icon","change",ker.wrap(this,d));Event.observe("thredds.collectionDatasetMd","click",ker.wrap(this,m));Event.observe("thredds.createDIFCollectionMd","click",ker.wrap(this,j));Event.observe("thredds.createFragmentsForCollections","click",ker.wrap(this,j));Event.observe("thredds.atomicDatasetMd","click",ker.wrap(this,r));Event.observe("thredds.createDIFAtomicMd","click",ker.wrap(this,o));Event.observe("thredds.createFragmentsForAtomics","click",ker.wrap(this,o));Event.observe("thredds.outputSchemaOnCollectionsFragments","change",ker.wrap(this,i));Event.observe("thredds.outputSchemaOnAtomicsFragments","change",ker.wrap(this,q));function z(){v.add([{id:"thredds.name",type:"length",minSize:1,maxSize:200},{id:"thredds.cataUrl",type:"length",minSize:1,maxSize:200},{id:"thredds.cataUrl",type:"url"},{id:"thredds.username",type:"length",minSize:0,maxSize:200},{id:"thredds.password",type:"length",minSize:0,maxSize:200},{id:"thredds.collectionFragmentStylesheet",type:"length",minSize:1,precond:[{id:"thredds.collectionDatasetMd",checked:true},{id:"thredds.createFragmentsForCollections",checked:true}]},{id:"thredds.atomicFragmentStylesheet",type:"length",minSize:1,precond:[{id:"thredds.atomicDatasetMd",checked:true},{id:"thredds.createFragmentsForAtomics",checked:true}]}]);w=new Shower("thredds.useAccount","thredds.account")}function B(){this.setEmptyCommon();$("thredds.createServiceMd").checked=false;$("thredds.collectionDatasetMd").checked=false;$("thredds.atomicDatasetMd").checked=false;$("thredds.createThumbnails").checked=false;$("thredds.ignoreHarvestOnCollections").checked=false;$("thredds.createDIFCollectionMd").checked=true;$("thredds.collectionFragmentStylesheet").value="";$("thredds.createCollectionSubtemplates").checked=false;$("thredds.collectionMetadataTemplate").value="";$("thredds.outputSchemaOnCollectionsDIF").value="";$("thredds.outputSchemaOnCollectionsFragments").value="";$("thredds.outputSchemaOnAtomicsDIF").value="";$("thredds.outputSchemaOnAtomicsFragments").value="";$("thredds.ignoreHarvestOnAtomics").checked=false;$("thredds.modifiedOnly").checked=false;$("thredds.createDIFAtomicMd").checked=true;$("thredds.atomicFragmentStylesheet").value="";$("thredds.createAtomicSubtemplates").checked=false;$("thredds.atomicMetadataTemplate").value="";$("thredds.lang").value="eng";$("thredds.topic").value="";$("thredds.cataUrl").value="";var E=$("thredds.icon").options;for(var D=0;D<E.length;D++){if(E[D].value=="default.gif"){E[D].selected=true;break}}w.update();d();m();r()}function g(F){this.setDataCommon(F);var E=F.getElementsByTagName("site")[0];var D=F.getElementsByTagName("options")[0];hvutil.setOption(E,"url","thredds.cataUrl");hvutil.setOption(E,"icon","thredds.icon");hvutil.setOption(D,"topic","thredds.topic");hvutil.setOption(D,"createThumbnails","thredds.createThumbnails");hvutil.setOption(D,"createServiceMd","thredds.createServiceMd");hvutil.setOption(D,"createCollectionDatasetMd","thredds.collectionDatasetMd");hvutil.setOption(D,"ignoreHarvestOnCollections","thredds.ignoreHarvestOnCollections");hvutil.setRadioOption(D,"collectionGeneration","thredds.collectionGenerationOption");hvutil.setOption(D,"outputSchemaOnCollectionsDIF","thredds.outputSchemaOnCollectionsDIF");hvutil.setOption(D,"outputSchemaOnCollectionsFragments","thredds.outputSchemaOnCollectionsFragments");if($("thredds.outputSchemaOnCollectionsFragments").selectedIndex>0){e=hvutil.find(D,"collectionFragmentStylesheet");c=hvutil.find(D,"collectionMetadataTemplate");i();hvutil.setOption(D,"createCollectionSubtemplates","thredds.createCollectionSubtemplates")}hvutil.setOption(D,"createAtomicDatasetMd","thredds.atomicDatasetMd");hvutil.setOption(D,"ignoreHarvestOnAtomics","thredds.ignoreHarvestOnAtomics");hvutil.setRadioOption(D,"atomicGeneration","thredds.atomicGenerationOption");hvutil.setOption(D,"outputSchemaOnAtomicsDIF","thredds.outputSchemaOnAtomicsDIF");hvutil.setOption(D,"outputSchemaOnAtomicsFragments","thredds.outputSchemaOnAtomicsFragments");if($("thredds.outputSchemaOnAtomicsFragments").selectedIndex>0){e=hvutil.find(D,"atomicFragmentStylesheet");c=hvutil.find(D,"atomicMetadataTemplate");q();hvutil.setOption(D,"createAtomicSubtemplates","thredds.createAtomicSubtemplates");hvutil.setOption(D,"modifiedOnly","thredds.modifiedOnly")}hvutil.setOption(D,"lang","thredds.lang");hvutil.setOption(D,"datasetCategory","thredds.datasetCategory");this.removeAllGroupRows();this.addGroupRows(F);this.unselectCategories();this.selectCategories(F);w.update();d();m();j();r();o()}function s(){var D=this.getDataCommon();D.CATA_URL=$F("thredds.cataUrl");D.ICON=$F("thredds.icon");D.LANG=$F("thredds.lang");D.TOPIC=$F("thredds.topic");D.CREATESERVICEMD=$("thredds.createServiceMd").checked;D.OUTPUTSCHEMAONCOLLECTIONSDIF=$F("thredds.outputSchemaOnCollectionsDIF");D.OUTPUTSCHEMAONCOLLECTIONSFRAGMENTS=$F("thredds.outputSchemaOnCollectionsFragments");D.IGNOREHARVESTONCOLLECTIONS=$("thredds.ignoreHarvestOnCollections").checked;D.COLLECTIONGENERATION=getCheckedValue("thredds.collectionGenerationOption");D.COLLECTIONFRAGMENTSTYLESHEET=$F("thredds.collectionFragmentStylesheet");D.CREATECOLLECTIONSUBTEMPLATES=$("thredds.createCollectionSubtemplates").checked;D.COLLECTIONMETADATATEMPLATE=$F("thredds.collectionMetadataTemplate");D.OUTPUTSCHEMAONATOMICSDIF=$F("thredds.outputSchemaOnAtomicsDIF");D.OUTPUTSCHEMAONATOMICSFRAGMENTS=$F("thredds.outputSchemaOnAtomicsFragments");D.IGNOREHARVESTONATOMICS=$("thredds.ignoreHarvestOnAtomics").checked;D.MODIFIEDONLY=$("thredds.modifiedOnly").checked;D.ATOMICGENERATION=getCheckedValue("thredds.atomicGenerationOption");D.ATOMICFRAGMENTSTYLESHEET=$F("thredds.atomicFragmentStylesheet");D.CREATEATOMICSUBTEMPLATES=$("thredds.createAtomicSubtemplates").checked;D.ATOMICMETADATATEMPLATE=$F("thredds.atomicMetadataTemplate");D.DATASETCATEGORY=$F("thredds.datasetCategory");D.CREATETHUMBNAILS=$("thredds.createThumbnails").checked;D.CREATECOLLECTIONDATASETMD=$("thredds.collectionDatasetMd").checked;D.CREATEATOMICDATASETMD=$("thredds.atomicDatasetMd").checked;D.PRIVILEGES=this.getPrivileges();D.CATEGORIES=this.getSelectedCategories();return D}function f(){if(!v.validate()){return false}return this.isDataValidCommon()}function k(){$("thredds.icon").options.length=0}function y(D){gui.addToSelect("thredds.icon",D,D)}function d(){var D=$F("thredds.icon");var E=$("thredds.icon.image");E.setAttribute("src",Env.url+"/images/harvesting/"+D)}function m(){if($("thredds.collectionDatasetMd").checked){$("collectionDatasetsHarvested").show()}else{$("collectionDatasetsHarvested").hide()}}function j(){if($("thredds.createDIFCollectionMd").checked){$("collectionDIFMetadataOptions").show();$("collectionFragmentOptions").hide()}else{$("collectionFragmentOptions").show();if($("thredds.outputSchemaOnCollectionsFragments").selectedIndex>0){$("collectionFragmentSchemaOptions").show()}$("collectionDIFMetadataOptions").hide()}}function r(){if($("thredds.atomicDatasetMd").checked){$("atomicDatasetsHarvested").show()}else{$("atomicDatasetsHarvested").hide()}}function o(){if($("thredds.createDIFAtomicMd").checked){$("atomicDIFMetadataOptions").show();$("atomicFragmentOptions").hide()}else{$("atomicFragmentOptions").show();if($("thredds.outputSchemaOnAtomicsFragments").selectedIndex>0){$("atomicFragmentSchemaOptions").show()}$("atomicDIFMetadataOptions").hide()}}function q(){var D=$("thredds.outputSchemaOnAtomicsFragments");if(D.selectedIndex>0){this.selectedSchema=D[D.selectedIndex].value;request=ker.createRequestFromObject({type:"threddsFragmentStylesheets",schema:this.selectedSchema});ker.send("xml.harvesting.info",request,ker.wrap(this,l));new InfoService(p,"templates",ker.wrap(this,h))}$("atomicFragmentSchemaOptions").show()}function l(D){if(D.nodeName=="error"){ker.showError(p.getText("cannotRetrieve"),D)}else{var G=[];var F=xml.children(xml.children(D)[0]);for(var E=0;E<F.length;E++){G.push(xml.toObject(F[E]))}}x(G)}function x(E){$("thredds.atomicFragmentStylesheet").options.length=0;gui.addToSelect("thredds.atomicFragmentStylesheet",0,"");for(var D=0;D<E.length;D++){var F="("+E[D].schema+") "+E[D].name;if(E[D].id==e){gui.addToSelect("thredds.atomicFragmentStylesheet",E[D].id,F,true)}else{gui.addToSelect("thredds.atomicFragmentStylesheet",E[D].id,F)}}}function h(E){$("thredds.atomicMetadataTemplate").options.length=0;gui.addToSelect("thredds.atomicMetadataTemplate",0,"");for(var D=0;D<E.length;D++){if(E[D].schema==this.selectedSchema){var F="("+E[D].schema+") "+E[D].title;if(E[D].id==c){gui.addToSelect("thredds.atomicMetadataTemplate",E[D].id,F,true)}else{gui.addToSelect("thredds.atomicMetadataTemplate",E[D].id,F)}}}}function i(){var D=$("thredds.outputSchemaOnCollectionsFragments");if(D.selectedIndex>0){this.selectedSchema=D[D.selectedIndex].value;request=ker.createRequestFromObject({type:"threddsFragmentStylesheets",schema:this.selectedSchema});ker.send("xml.harvesting.info",request,ker.wrap(this,u));new InfoService(p,"templates",ker.wrap(this,A))}$("collectionFragmentSchemaOptions").show()}function u(D){if(D.nodeName=="error"){ker.showError(p.getText("cannotRetrieve"),D)}else{var G=[];var F=xml.children(xml.children(D)[0]);for(var E=0;E<F.length;E++){G.push(xml.toObject(F[E]))}}n(G)}function n(E){$("thredds.collectionFragmentStylesheet").options.length=0;gui.addToSelect("thredds.collectionFragmentStylesheet",0,"");for(var D=0;D<E.length;D++){var F="("+E[D].schema+") "+E[D].name;if(E[D].id==e){gui.addToSelect("thredds.collectionFragmentStylesheet",E[D].id,F,true)}else{gui.addToSelect("thredds.collectionFragmentStylesheet",E[D].id,F)}}}function A(E){$("thredds.collectionMetadataTemplate").options.length=0;gui.addToSelect("thredds.collectionMetadataTemplate",0,"");for(var D=0;D<E.length;D++){if(E[D].schema==this.selectedSchema){var F="("+E[D].schema+") "+E[D].title;if(E[D].id==c){gui.addToSelect("thredds.collectionMetadataTemplate",E[D].id,F,true)}else{gui.addToSelect("thredds.collectionMetadataTemplate",E[D].id,F)}}}}};