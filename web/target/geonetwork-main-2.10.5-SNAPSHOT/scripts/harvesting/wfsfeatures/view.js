wfsfeatures.View=function(b){HarvesterView.call(this);var a=new XSLTransformer("harvesting/wfsfeatures/client-privil-row.xsl",b);var m=new XSLTransformer("harvesting/wfsfeatures/client-result-tip.xsl",b);var j=b;var n=new Validator(j);var o=null;var e="";var c="";var t=0;this.setPrefix("wfsfeatures");this.setPrivilTransf(a);this.setResultTransf(m);this.init=q;this.setEmpty=s;this.setData=g;this.getData=l;this.isDataValid=f;this.clearIcons=h;this.addIcon=p;Event.observe("wfsfeatures.outputSchema","change",ker.wrap(this,u));Event.observe("wfsfeatures.icon","change",ker.wrap(this,d));function q(){n.add([{id:"wfsfeatures.name",type:"length",minSize:1,maxSize:200},{id:"wfsfeatures.url",type:"length",minSize:1,maxSize:200},{id:"wfsfeatures.url",type:"url"},{id:"wfsfeatures.username",type:"length",minSize:0,maxSize:200},{id:"wfsfeatures.password",type:"length",minSize:0,maxSize:200},{id:"wfsfeatures.stylesheet",type:"length",minSize:1,precond:[{id:"wfsfeatures.streamFeatures",checked:true}]},{id:"wfsfeatures.outputSchema",type:"length",minSize:1,maxSize:200},{id:"wfsfeatures.query",type:"length",minSize:1,maxSize:99999999999},{id:"wfsfeatures.templateId",type:"length",minValue:1,maxValue:99999999}]);o=new Shower("wfsfeatures.useAccount","wfsfeatures.account")}function s(){this.setEmptyCommon();$("wfsfeatures.lang").value="eng";$("wfsfeatures.templateId").value="0";$("wfsfeatures.url").value="";$("wfsfeatures.query").value="";$("wfsfeatures.outputSchema").value="";$("wfsfeatures.stylesheet").value="";$("wfsfeatures.streamFeatures").checked=false;$("wfsfeatures.createSubtemplates").checked=true;var w=$("wfsfeatures.icon").options;for(var v=0;v<w.length;v++){if(w[v].value=="wfs.gif"){w[v].selected=true;break}}o.update();d()}function g(x){this.setDataCommon(x);var w=x.getElementsByTagName("site")[0];var v=x.getElementsByTagName("options")[0];hvutil.setOption(w,"url","wfsfeatures.url");hvutil.setOption(v,"lang","wfsfeatures.lang");hvutil.setOption(v,"query","wfsfeatures.query");hvutil.setOption(v,"outputSchema","wfsfeatures.outputSchema");if($("wfsfeatures.outputSchema").selectedIndex>0){e=hvutil.find(v,"stylesheet");c=hvutil.find(v,"templateId");u();hvutil.setOption(v,"streamFeatures","wfsfeatures.streamFeatures");hvutil.setOption(v,"createSubtemplates","wfsfeatures.createSubtemplates")}hvutil.setOption(v,"recordsCategory","wfsfeatures.recordsCategory");this.removeAllGroupRows();this.addGroupRows(x);this.unselectCategories();this.selectCategories(x);o.update();d()}function l(){var v=this.getDataCommon();v.URL=$F("wfsfeatures.url");v.LANG=$F("wfsfeatures.lang");v.QUERY=$F("wfsfeatures.query");v.OUTPUTSCHEMA=$F("wfsfeatures.outputSchema");v.STYLESHEET=$F("wfsfeatures.stylesheet");v.STREAMFEATURES=$("wfsfeatures.streamFeatures").checked;v.CREATESUBTEMPLATES=$("wfsfeatures.createSubtemplates").checked;v.TEMPLATEID=$F("wfsfeatures.templateId");v.RECORDSCATEGORY=$F("wfsfeatures.recordsCategory");v.ICON=$F("wfsfeatures.icon");v.PRIVILEGES=this.getPrivileges();v.CATEGORIES=this.getSelectedCategories();return v}function f(){if(!n.validate()){return false}return this.isDataValidCommon()}function h(){$("wfsfeatures.icon").options.length=0}function p(v){gui.addToSelect("wfsfeatures.icon",v,v)}function d(){var v=$F("wfsfeatures.icon");var w=$("wfsfeatures.icon.image");w.setAttribute("src",Env.url+"/images/harvesting/"+v)}function u(){var v=$("wfsfeatures.outputSchema");if(v.selectedIndex>0){this.selectedSchema=v[v.selectedIndex].value;request=ker.createRequestFromObject({type:"wfsFragmentStylesheets",schema:this.selectedSchema});ker.send("xml.harvesting.info",request,ker.wrap(this,k));new InfoService(j,"templates",ker.wrap(this,r))}$("wfsFeaturesSchemaOptions").show()}function k(v){if(v.nodeName=="error"){ker.showError(j.getText("cannotRetrieve"),v)}else{var y=[];var x=xml.children(xml.children(v)[0]);for(var w=0;w<x.length;w++){y.push(xml.toObject(x[w]))}}i(y)}function i(w){$("wfsfeatures.stylesheet").options.length=0;gui.addToSelect("wfsfeatures.stylesheet",0,"");for(var v=0;v<w.length;v++){var x="("+w[v].schema+") "+w[v].name;if(w[v].id==e){gui.addToSelect("wfsfeatures.stylesheet",w[v].id,x,true)}else{gui.addToSelect("wfsfeatures.stylesheet",w[v].id,x)}}}function r(w){$("wfsfeatures.templateId").options.length=0;gui.addToSelect("wfsfeatures.templateId",0,"");for(var v=0;v<w.length;v++){if(w[v].schema==this.selectedSchema){var x="("+w[v].schema+") "+w[v].title;if(w[v].id==c){gui.addToSelect("wfsfeatures.templateId",w[v].id,x,true)}else{gui.addToSelect("wfsfeatures.templateId",w[v].id,x)}}}}};