oaipmh.View=function(c){HarvesterView.call(this);var g=new XSLTransformer("harvesting/oaipmh/client-search-row.xsl",c);var a=new XSLTransformer("harvesting/oaipmh/client-privil-row.xsl",c);var m=new XSLTransformer("harvesting/oaipmh/client-result-tip.xsl",c);var k=c;var n=new Validator(k);var o=null;var v=null;var y=0;this.setPrefix("oai");this.setPrivilTransf(a);this.setResultTransf(m);Ajax.Responders.register({onCreate:function(){if(Ajax.activeRequestCount===1){var z=$("harvesterBusy");if(z){z.show()}}},onComplete:function(){if(Ajax.activeRequestCount===0){var z=$("harvesterBusy");if(z){z.hide()}}}});this.init=t;this.setEmpty=u;this.setData=h;this.getData=l;this.isDataValid=f;this.clearIcons=j;this.addIcon=s;this.addEmptySearch=q;this.setInfo=e;this.getUrl=p;Event.observe("oai.icon","change",ker.wrap(this,d));function t(){n.add([{id:"oai.name",type:"length",minSize:1,maxSize:200},{id:"oai.url",type:"length",minSize:1,maxSize:200},{id:"oai.url",type:"url"},{id:"oai.username",type:"length",minSize:0,maxSize:200},{id:"oai.password",type:"length",minSize:0,maxSize:200}]);o=new Shower("oai.useAccount","oai.account");gui.setupTooltips(k.getNode("tips"))}function u(){this.setEmptyCommon();v=null;r();$("oai.url").value="";$("wd.validate").checked=false;var A=$("oai.icon").options;for(var z=0;z<A.length;z++){if(A[z].value=="default.gif"){A[z].selected=true;break}}o.update();d()}function h(D){this.setDataCommon(D);v=null;var A=D.getElementsByTagName("site")[0];var C=D.getElementsByTagName("searches")[0];var z=D.getElementsByTagName("options")[0];hvutil.setOption(A,"url","oai.url");hvutil.setOption(A,"icon","oai.icon");hvutil.setOption(z,"validate","oai.validate");var E=C.getElementsByTagName("search");r();for(var B=0;B<E.length;B++){b(E[B])}this.removeAllGroupRows();this.addGroupRows(D);this.unselectCategories();this.selectCategories(D);o.update();d()}function l(){var C=this.getDataCommon();C.URL=$F("oai.url");C.ICON=$F("oai.icon");C.VALIDATE=$("oai.validate").checked;var B=[];var A=xml.children($("oai.searches"));for(var z=0;z<A.length;z++){var E=A[z];var D=E.getAttribute("id");B.push({FROM:$F(D+".oai.from"),UNTIL:$F(D+".oai.until"),SET:$F(D+".oai.set"),PREFIX:$F(D+".oai.prefix"),STYLESHEET:$F(D+".oai.stylesheet")})}C.SEARCH_LIST=B;C.PRIVILEGES=this.getPrivileges();C.CATEGORIES=this.getSelectedCategories();return C}function f(){if(!n.validate()){return false}return this.isDataValidCommon()}function j(){$("oai.icon").options.length=0}function s(z){gui.addToSelect("oai.icon",z,z)}function d(){var z=$F("oai.icon");var A=$("oai.icon.image");A.setAttribute("src",Env.url+"/images/harvesting/"+z)}function e(C){v=C;var B=[];var A=xml.children($("oai.searches"));for(var z=0;z<A.length;z++){var G=A[z];var F=G.getAttribute("id");var E=$F(F+".oai.set_select");var D=$F(F+".oai.prefix_select");x(F,E,D);$(F+".oai.prefixes.cols").show();$(F+".oai.sets.cols").show()}}function x(G,F,E){var A=$(G+".oai.set_select");var z=$(G+".oai.prefix_select");i(A);w(A,"","",F);for(var D=0;D<v.SETS.length;D++){var C=v.SETS[D].NAME;var B=v.SETS[D].LABEL;w(A,C,B,F)}i(z);w(z,"oai_dc","oai_dc",F);for(var D=0;D<v.FORMATS.length;D++){var C=v.FORMATS[D];w(z,C,C,E)}}function i(z){z.options.length=0}function w(C,A,z,B){gui.addToSelect(C,A,z,A==B)}function q(){var A=Sarissa.getDomDocument();var z=A.createElement("search");b(z)}function b(A){var D=""+y++;A.setAttribute("id",D);var z=g.transformToText(A);new Insertion.Bottom("oai.searches",z);Event.observe(D+".oai.remove","click",ker.wrap(this,function(){Element.remove(D)}));initCalendar();gui.setupTooltip(D+".oai.remove",k.evalNode('tips/tip[@id="oai.remove"]'));gui.setupTooltip(D+".oai.from",k.evalNode('tips/tip[@id="oai.from"]'));gui.setupTooltip(D+".oai.until",k.evalNode('tips/tip[@id="oai.until"]'));gui.setupTooltip(D+".oai.set",k.evalNode('tips/tip[@id="oai.set"]'));gui.setupTooltip(D+".oai.prefix",k.evalNode('tips/tip[@id="oai.prefix"]'));var C=xml.evalXPath(A,"set");var B=xml.evalXPath(A,"prefix");if(v==null){gui.addToSelect(D+".oai.set_select","","",false);gui.addToSelect(D+".oai.prefix_select","oai_dc","oai_dc",false);if(C!=null&&C!=""){gui.addToSelect(D+".oai.set_select",C,C,true)}if(B!=null&&B!="oai_dc"){gui.addToSelect(D+".oai.prefix_select",B,B,true)}}else{x(D,C,B)}}function r(){$("oai.searches").innerHTML=""}function p(){return $F("oai.url")}};