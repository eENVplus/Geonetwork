gn.View=function(b){HarvesterView.call(this);var h=new XSLTransformer("harvesting/geonet/client-search-row.xsl",b);var q=new XSLTransformer("harvesting/geonet/client-policy-row.xsl",b);var p=new XSLTransformer("harvesting/geonet/client-result-tip.xsl",b);var m=b;var r=new Validator(m);var s=null;var c=null;var B=0;this.setPrefix("gn");this.setResultTransf(p);this.init=x;this.setEmpty=z;this.setData=i;this.getData=n;this.isDataValid=e;this.setSources=u;this.addEmptySearch=v;this.addSearch=a;this.removeSearch=k;this.removeAllSearch=w;this.getHostData=t;this.getPolicyGroups=d;this.getListedPolicyGroups=l;this.addPolicyGroup=f;this.removePolicyGroup=g;this.removeAllPolicyGroups=o;this.findPolicyGroup=A;this.removeAllGroupRows=function(){};function x(){r.add([{id:"gn.name",type:"length",minSize:1,maxSize:200},{id:"gn.host",type:"length",minSize:1,maxSize:200},{id:"gn.host",type:"url"},{id:"gn.username",type:"length",minSize:0,maxSize:200},{id:"gn.password",type:"length",minSize:0,maxSize:200}]);s=new Shower("gn.useAccount","gn.account");gui.setupTooltips(m.getNode("tips"))}function z(){this.setEmptyCommon();c=null;w();o();$("gn.host").value="";$("gn.createRemoteCategory").checked=false;$("gn.mefFormatFull").checked=false;$("gn.xslfilter").value="";s.update()}function i(H){this.setDataCommon(H);c=null;var E=H.getElementsByTagName("site")[0];var G=H.getElementsByTagName("searches")[0];var C=H.getElementsByTagName("groupsCopyPolicy")[0];hvutil.setOption(E,"host","gn.host");hvutil.setOption(E,"createRemoteCategory","gn.createRemoteCategory");hvutil.setOption(E,"mefFormatFull","gn.mefFormatFull");hvutil.setOption(E,"xslfilter","gn.xslfilter");var I=G.getElementsByTagName("search");w();for(var F=0;F<I.length;F++){a(I[F])}var I=C.getElementsByTagName("group");o();for(var F=0;F<I.length;F++){var D=I[F].getAttribute("name");var J=I[F].getAttribute("policy");f(D,J)}this.unselectCategories();this.selectCategories(H);s.update()}function n(){var G=this.getDataCommon();G.HOST=$F("gn.host");G.CREATE_REMOTE_CATEGORY=$("gn.createRemoteCategory").checked;G.MEF_FULL=$("gn.mefFormatFull").checked;G.XSLFILTER=$F("gn.xslfilter");var F=[];var E=xml.children($("gn.searches"));for(var C=0;C<E.length;C++){var H=E[C];var D=xml.getElementById(H,"gn.source");F.push({TEXT:xml.getElementById(H,"gn.text").value,TITLE:xml.getElementById(H,"gn.title").value,ABSTRACT:xml.getElementById(H,"gn.abstract").value,KEYWORDS:xml.getElementById(H,"gn.keywords").value,ANYFIELD:xml.getElementById(H,"gn.anyField").value,ANYVALUE:xml.getElementById(H,"gn.anyValue").value,DIGITAL:xml.getElementById(H,"gn.digital").checked,HARDCOPY:xml.getElementById(H,"gn.hardcopy").checked,SOURCE_UUID:$F(D),SOURCE_NAME:xml.textContent(D.options[D.selectedIndex])})}G.SEARCH_LIST=F;G.CATEGORIES=this.getSelectedCategories();G.GROUP_LIST=d();return G}function e(){if(!r.validate()){return false}return this.isDataValidCommon()}function u(H){c=H;var I=[];var K=xml.children($("gn.searches"));for(var J=0;J<K.length;J++){var C=xml.getElementById(K[J],"gn.source");var F=$F(C);y(C);j(C,"","",F);for(var G=0;G<H.length;G++){var D=H[G].uuid;var E=H[G].name;j(C,D,E,F)}}}function y(C){C.options.length=0}function j(F,D,C,E){gui.addToSelect(F,D,C,D==E)}function v(){var F=Sarissa.getDomDocument();var D=F.createElement("search");if(c!=null){var G=F.createElement("sources");for(var C=0;C<c.length;C++){var E=F.createElement("source");E.setAttribute("name",c[C].name);E.setAttribute("uuid",c[C].uuid);G.appendChild(E)}D.appendChild(G)}F.appendChild(D);a(D)}function a(D){var E=""+B++;D.setAttribute("id",E);var C=h.transformToText(D);new Insertion.Bottom("gn.searches",C);r.add([{id:"gn.text",type:"length",minSize:0,maxSize:200},{id:"gn.title",type:"length",minSize:0,maxSize:200},{id:"gn.abstract",type:"length",minSize:0,maxSize:200},{id:"gn.keywords",type:"length",minSize:0,maxSize:200}],E)}function k(C){r.removeByParent(C);Element.remove(C)}function w(){$("gn.searches").innerHTML="";r.removeByParent()}function d(){var E=[];var D=$("gn.groups").getElementsByTagName("TR");for(var F=1;F<D.length;F++){var G=D[F];var J=G.getAttribute("id");var C=J.substring(9);var H=G.getElementsByTagName("SELECT");var I=$F(H[0]);if(I!="dontCopy"){E.push({NAME:C,POLICY:I})}}return E}function l(){var E=[];var D=$("gn.groups").getElementsByTagName("TR");for(var F=1;F<D.length;F++){var G=D[F];var H=G.getAttribute("id");var C=H.substring(9);E.push(C)}return E}function f(C,G){var F=Sarissa.getDomDocument();var E=F.createElement("group");E.setAttribute("name",C);E.setAttribute("policy",G);var D=q.transform(E);gui.appendTableRow("gn.groups",D)}function g(C){Element.remove("gn.group."+C)}function o(){var D=$("gn.groups").getElementsByTagName("TR");for(var C=D.length-1;C>0;C--){Element.remove(D[C])}}function A(C){var F=$("gn.groups").getElementsByTagName("TR");for(var D=1;D<F.length;D++){var G=F[D];var E=G.getAttribute("id");if("gn.group."+C==E){return G}}return null}function t(){var C={HOST:$F("gn.host"),USERNAME:$F("gn.username"),PASSWORD:$F("gn.password"),USE_ACCOUNT:$("gn.useAccount").checked,XSLFILTER:$F("gn.xslfilter")};return C}};