z3950.View=function(b){HarvesterView.call(this);var a=new XSLTransformer("harvesting/z3950/client-privil-row.xsl",b);var j=new XSLTransformer("harvesting/z3950/client-result-tip.xsl",b);var h=b;var n=new Validator(h);var o=null;var u=0;this.setPrefix("z3950");this.setPrivilTransf(a);this.setResultTransf(j);this.init=q;this.setEmpty=r;this.setData=f;this.getData=i;this.isDataValid=d;this.clearIcons=g;this.addIcon=p;this.clearRepositories=m;this.unselectRepositories=l;this.addRepository=s;this.getSelectedRepositories=t;Event.observe("z3950.icon","change",ker.wrap(this,c));function q(){n.add([{id:"z3950.name",type:"length",minSize:1,maxSize:200},{id:"z3950.repositories",type:"length",minSize:1,maxSize:200},{id:"z3950.query",type:"length",minSize:1,maxSize:200},{id:"z3950.username",type:"length",minSize:0,maxSize:200},{id:"z3950.password",type:"length",minSize:0,maxSize:200}]);o=new Shower("z3950.useAccount","z3950.account")}function r(){this.setEmptyCommon();this.unselectRepositories();$("z3950.query").value="";var w=$("z3950.icon").options;for(var v=0;v<w.length;v++){if(w[v].value=="default.gif"){w[v].selected=true;break}}o.update();c()}function f(w){this.setDataCommon(w);var v=w.getElementsByTagName("site")[0];l();k(w);hvutil.setOption(v,"query","z3950.query");hvutil.setOption(v,"icon","z3950.icon");this.removeAllGroupRows();this.addGroupRows(w);this.unselectCategories();this.selectCategories(w);o.update();c()}function i(){var v=this.getDataCommon();v.REPOSITORIES=this.getSelectedRepositories();v.QUERY=$F("z3950.query");v.ICON=$F("z3950.icon");v.PRIVILEGES=this.getPrivileges();v.CATEGORIES=this.getSelectedCategories();return v}function d(){if(!n.validate()){return false}return this.isDataValidCommon()}function g(){$("z3950.icon").options.length=0}function p(w){var v='<option value="'+w+'">'+xml.escape(w)+"</option>";new Insertion.Bottom("z3950.icon",v)}function c(){var v=$F("z3950.icon");var w=$("z3950.icon.image");w.setAttribute("src",Env.url+"/images/harvesting/"+v)}function m(){$("z3950.repositories").options.length=0}function s(w,v){gui.addToSelect("z3950.repositories",w,v)}function l(){var w=$("z3950.repositories");for(var v=0;v<w.options.length;v++){w.options[v].selected=false}}function k(x){var w=x.getElementsByTagName("repositories");if(w.length==0){return}var y=w[0].getElementsByTagName("repository");for(var v=0;v<y.length;v++){e(y[v])}}function e(w){var y=w.getAttribute("id");var x=$("z3950.repositories");for(var v=0;v<x.options.length;v++){if(x.options[v].value==y){x.options[v].selected=true;return}}}function t(y){var x=$("z3950.repositories");var v=[];for(var w=0;w<x.options.length;w++){if(x.options[w].selected){v.push({ID:x.options[w].value})}}return v}};