z3950.Model=function(m){HarvesterModel.call(this);var k=m;var f=null;var g=null;this.retrieveImportXslts=i;this.retrieveGroups=h;this.retrieveCategories=l;this.retrieveIcons=b;this.retrieveRepositories=e;this.getUpdateRequest=d;function h(n){new InfoService(k,"groupsIncludingSystemGroups",n)}function l(n){new InfoService(k,"categories",n)}function i(o){g=o;var n=ker.createRequest("type","importStylesheets");ker.send("xml.harvesting.info",n,ker.wrap(this,c))}function c(n){if(n.nodeName=="error"){ker.showError(k.getText("cannotRetrieve"),n)}else{var q=[];var p=xml.children(xml.children(n)[0]);for(var o=0;o<p.length;o++){q.push(xml.toObject(p[o]))}g(q)}}function e(n){new InfoService(k,"z3950repositories",n)}function b(o){f=o;var n=ker.createRequest("type","icons");ker.send("xml.harvesting.info",n,ker.wrap(this,j))}function j(n){if(n.nodeName=="error"){ker.showError(k.getText("cannotRetrieve"),n)}else{var q=[];var p=xml.children(xml.children(n)[0]);for(var o=0;o<p.length;o++){q.push(xml.textContent(p[o]))}f(q)}}function d(q){var o=str.substitute(a,q);var r="";var p=q.REPOSITORIES;if(p!=null){for(var n=0;n<p.length;n++){r+='<repository id="'+p[n].ID+'"/>'}o=str.replace(o,"{REPOSITORY_LIST}",r)}return this.substituteCommon(q,o)}var a=' <node id="{ID}" type="{TYPE}">    <ownerGroup><id>{OWNERGROUP}</id></ownerGroup>    <site>      <name>{NAME}</name>      <repositories>        {REPOSITORY_LIST}      </repositories>      <query>{QUERY}</query>      <icon>{ICON}</icon>      <account>        <use>{USE_ACCOUNT}</use>        <username>{USERNAME}</username>        <password>{PASSWORD}</password>      </account>    </site>    <options>      <oneRunOnly>{ONE_RUN_ONLY}</oneRunOnly>      <every>{EVERY}</every>    </options>    <content>      <validate>{VALIDATE}</validate>      <importxslt>{IMPORTXSLT}</importxslt>    </content>    <privileges>       {PRIVIL_LIST}    </privileges>    <categories>       {CATEG_LIST}    </categories>  </node>'};